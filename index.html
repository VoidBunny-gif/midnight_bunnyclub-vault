<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Babe</title>
  <style>
    :root{
      --bg:#07070a;
      --paper:#f4f1ea;
      --paper2:#efe9dd;
      --ink:#111;
      --muted:#6c6a66;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 50% 38%, #111118 0%, var(--bg) 55%, #050507 100%);
      color:#fff;
      overflow:hidden;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
    }

    /* Center stage */
    .stage{
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
      position:relative;
      z-index:2;
    }

    .hint{
      position:absolute;
      bottom:28px;
      left:0; right:0;
      text-align:center;
      letter-spacing:.22em;
      text-transform:uppercase;
      font: 12px/1.2 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      opacity:.75;
      user-select:none;
      pointer-events:none;
    }

    /* Envelope card */
    .card{
      width:min(560px, 92vw);
      aspect-ratio: 16 / 9;
      border-radius: var(--radius);
      background: rgba(255,255,255,.04);
      box-shadow: var(--shadow);
      position:relative;
      display:grid;
      place-items:center;
      perspective: 1200px;
    }

    /* Envelope body */
    .envelope{
      width:min(520px, 86vw);
      height:min(300px, 50vw);
      max-height:320px;
      position:relative;
      transform-style:preserve-3d;
      cursor:pointer;
      user-select:none;
      border-radius: 14px;
      outline:none;
    }

    /* Two-sided flip wrapper */
    .flip{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition: transform 900ms cubic-bezier(.2,.9,.1,1);
      border-radius:14px;
    }

    body.state-1 .flip{
      transform: rotateY(180deg);
    }

    .side{
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius:14px;
      overflow:hidden;
      background: linear-gradient(180deg, var(--paper) 0%, var(--paper2) 100%);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 14px 35px rgba(0,0,0,.25);
    }

    .side.back{
      transform: rotateY(180deg);
    }

    /* Front: flap DOWN facing viewer (what you asked) */
    .flap-down{
      position:absolute;
      inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,0)),
        linear-gradient(135deg, rgba(0,0,0,.06), rgba(0,0,0,0));
    }

    /* Flap triangle (down) */
    .flap-tri{
      position:absolute;
      left:50%;
      top:-2px;
      width:0; height:0;
      transform: translateX(-50%);
      border-left: 270px solid transparent;
      border-right:270px solid transparent;
      border-top: 170px solid rgba(0,0,0,.06); /* subtle crease */
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.10));
      opacity:.9;
    }

    /* Address */
    .address{
      position:absolute;
      left:26px;
      top:22px;
      color: var(--ink);
      opacity:.95;
    }
    .address .for{
      font-size:18px;
      margin-bottom:4px;
      opacity:.8;
      font-style:italic;
    }
    .address .name{
      font-size:56px;
      font-weight:700;
      line-height:1;
      letter-spacing:-.02em;
      margin:0 0 14px 0;
    }
    .address .from{
      font: 14px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      color: rgba(0,0,0,.68);
    }

    /* Back: flap UP (after first click) */
    .flap-up{
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,0)),
        linear-gradient(135deg, rgba(0,0,0,.03), rgba(0,0,0,0));
    }
    .flap-up .tri{
      position:absolute;
      left:50%;
      bottom:-2px;
      width:0; height:0;
      transform: translateX(-50%);
      border-left: 270px solid transparent;
      border-right:270px solid transparent;
      border-bottom: 170px solid rgba(0,0,0,.06);
      filter: drop-shadow(0 -10px 12px rgba(0,0,0,.10));
      opacity:.9;
    }

    /* Open state (second click): reveal note */
    .note{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      opacity:0;
      transform: translateY(10px);
      transition: opacity 500ms ease, transform 500ms ease;
      pointer-events:none;
    }
    body.state-2 .note{
      opacity:1;
      transform: translateY(0);
    }

    .note .paper{
      width:min(420px, 72vw);
      padding:16px 18px;
      border-radius:12px;
      background: rgba(255,255,255,.92);
      color:#111;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      border: 1px solid rgba(0,0,0,.08);
      font: 16px/1.35 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    .note .paper strong{
      font-weight:700;
    }
    .note .sub{
      margin-top:6px;
      color:#333;
      opacity:.75;
      font-size:13px;
      letter-spacing:.08em;
      text-transform:lowercase;
    }

    /* Small instruction on envelope */
    .micro{
      position:absolute;
      left:26px;
      bottom:18px;
      color: rgba(0,0,0,.55);
      font: 13px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      opacity:.8;
    }

    /* Tunnel overlay (third click) */
    .tunnel{
      position:fixed;
      inset:0;
      z-index:1;
      opacity:0;
      pointer-events:none;
      transition: opacity 500ms ease;
      background:#000;
    }
    body.state-3 .tunnel{
      opacity:1;
      pointer-events:auto;
    }
    canvas{
      width:100%;
      height:100%;
      display:block;
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .flip{ transition:none; }
      .note{ transition:none; }
      .tunnel{ transition:none; }
    }
  </style>
</head>

<body class="state-0">
  <!-- Tunnel (appears on state-3) -->
  <div class="tunnel" aria-hidden="true">
    <canvas id="tunnelCanvas"></canvas>
  </div>

  <div class="stage">
    <div class="card">
      <div class="envelope" id="gate" tabindex="0" role="button" aria-label="Envelope gate. Click to proceed.">
        <div class="flip">
          <!-- FRONT (flap DOWN) -->
          <div class="side front">
            <div class="flap-down">
              <div class="flap-tri"></div>
            </div>

            <div class="address">
              <div class="for">To</div>
              <div class="name">Babe</div>
              <div class="from">Fr: Nasia Jade</div>
            </div>

            <div class="micro">click again.</div>
          </div>

          <!-- BACK (flap UP) -->
          <div class="side back">
            <div class="flap-up">
              <div class="tri"></div>
            </div>
            <div class="address" style="top:26px;">
              <div class="for">for</div>
              <div class="name" style="font-size:54px;">Babe</div>
              <div class="from">turning it over…</div>
            </div>
            <div class="micro">click again.</div>
          </div>
        </div>

        <!-- NOTE (revealed on state-2) -->
        <div class="note">
          <div class="paper">
            <strong>i left this here for you.</strong><br/>
            enter gently.
            <div class="sub">(one more click)</div>
          </div>
        </div>
      </div>
    </div>

    <div class="hint">tap / click • three steps • enter gently</div>
  </div>

  <script>
    // 3-step gate:
    // state-0 = front (flap down)
    // state-1 = flipped (flap up)
    // state-2 = open + note
    // state-3 = tunnel animation + redirect to /vault/
    (function(){
      const body = document.body;
      const gate = document.getElementById('gate');

      let step = 0;

      function setState(n){
        body.classList.remove('state-0','state-1','state-2','state-3');
        body.classList.add(`state-${n}`);
      }

      function next(){
        step = Math.min(step + 1, 3);
        setState(step);

        if(step === 3){
          startTunnel();
          // Give the tunnel a moment to pull them in, then enter the vault
          setTimeout(() => {
            window.location.href = "/vault/";
          }, 1250);
        }
      }

      gate.addEventListener('click', (e) => {
        e.preventDefault();
        next();
      });

      gate.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          next();
        }
      });

      // ---- Tunnel animation (real moving depth, not flat spiral) ----
      const canvas = document.getElementById('tunnelCanvas');
      const ctx = canvas.getContext('2d');

      let w, h, dpr, rafId;
      let t = 0;

      function resize(){
        dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        w = canvas.clientWidth;
        h = canvas.clientHeight;
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }

      window.addEventListener('resize', resize);

      function draw(){
        t += 0.016;

        ctx.clearRect(0,0,w,h);

        // subtle vignette
        const vg = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, Math.max(w,h)/1.15);
        vg.addColorStop(0, 'rgba(10,10,14,0.15)');
        vg.addColorStop(0.55, 'rgba(0,0,0,0.78)');
        vg.addColorStop(1, 'rgba(0,0,0,1)');
        ctx.fillStyle = vg;
        ctx.fillRect(0,0,w,h);

        // moving tunnel rings
        const cx = w/2, cy = h/2;
        const maxR = Math.hypot(w,h) * 0.7;

        // We render rings that "advance" toward viewer: spacing changes over time.
        const speed = 220;               // overall travel speed
        const depth = 44;                // number of rings
        const base = (t * speed) % 80;   // phase offset

        for(let i=0;i<depth;i++){
          // nearer rings are brighter and thicker
          const z = (i * 80 + base); // depth coordinate
          const p = (z % (depth*80)) / (depth*80); // 0..1
          const ease = Math.pow(1 - p, 2.2);

          const r = 40 + ease * maxR;
          const alpha = 0.02 + ease * 0.12;

          // slight wobble so it feels alive (not a flat spiral)
          const wobX = Math.sin(t*1.6 + i*0.45) * (6 + 10*ease);
          const wobY = Math.cos(t*1.3 + i*0.50) * (6 + 10*ease);

          ctx.beginPath();
          ctx.arc(cx + wobX, cy + wobY, r, 0, Math.PI*2);
          ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx.lineWidth = 1 + 3.2*ease;
          ctx.stroke();
        }

        // faint grain
        ctx.fillStyle = 'rgba(255,255,255,0.03)';
        for(let i=0;i<120;i++){
          const x = Math.random()*w;
          const y = Math.random()*h;
          ctx.fillRect(x,y,1,1);
        }

        rafId = requestAnimationFrame(draw);
      }

      let tunnelRunning = false;
      function startTunnel(){
        if(tunnelRunning) return;
        tunnelRunning = true;
        resize();
        draw();
      }
    })();
  </script>
</body>
</html>
