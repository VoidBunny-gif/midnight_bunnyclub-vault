<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Babe</title>

  <!-- Handwritten + serif pairing -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500&family=Nanum+Pen+Script&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#06060a;
      --bg1:#0b0b12;

      --paperBase:#f3efe6;
      --paperWarm:#efe6d7;
      --paperEdge:#e7dcc9;

      --ink:#151515;
      --muted:rgba(0,0,0,.50);

      --shadowA: 0 28px 70px rgba(0,0,0,.55);
      --shadowB: 0 18px 40px rgba(0,0,0,.40);

      --radius:18px;

      /* Antique ceremonial gold (wax) */
      --gold1:#f7e39b;
      --gold2:#d1a947;
      --gold3:#8a6318;
      --gold4:#f3d57e;
      --gold5:#b3832a;

      --ease: cubic-bezier(.2,.9,.15,1);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:#fff;
      overflow:hidden;
      background:
        radial-gradient(900px 600px at 50% 38%, #151520 0%, var(--bg1) 40%, var(--bg0) 100%);
      font-family: "EB Garamond", ui-serif, Georgia, serif;
    }

    /* Stage */
    .stage{
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
      position:relative;
      z-index:2;
    }

    .hint{
      position:absolute;
      bottom:26px;
      left:0; right:0;
      text-align:center;
      letter-spacing:.24em;
      text-transform:uppercase;
      font: 12px/1.2 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      opacity:.72;
      user-select:none;
      pointer-events:none;
    }

    /* Container / card */
    .card{
      width:min(680px, 94vw);
      aspect-ratio: 16 / 9;
      border-radius: var(--radius);
      background: rgba(255,255,255,.035);
      box-shadow: var(--shadowA);
      display:grid;
      place-items:center;
      position:relative;
      perspective: 1400px;
      isolation:isolate;
    }

    /* Envelope wrapper */
    .envelope{
      width:min(560px, 88vw);
      height:min(340px, 56vw);
      max-height:360px;
      position:relative;
      transform-style:preserve-3d;
      cursor:pointer;
      user-select:none;
      outline:none;
    }

    /* Flip "book" */
    .flip{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition: transform 980ms var(--ease);
      border-radius:14px;
    }
    body.step-1 .flip{ transform: rotateY(180deg); }

    .side{
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius:14px;
      overflow:hidden;
      box-shadow: var(--shadowB);
      border: 1px solid rgba(0,0,0,.10);
      background: linear-gradient(180deg, var(--paperBase) 0%, var(--paperWarm) 100%);
    }
    .side.back{ transform: rotateY(180deg); }

    /* Real-ish paper texture layer */
    .paperTex{
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 700px at 50% 15%, rgba(255,255,255,.55), rgba(255,255,255,0) 55%),
        linear-gradient(180deg, rgba(255,255,255,.25), rgba(0,0,0,.03));
      pointer-events:none;
      mix-blend-mode: soft-light;
      opacity:.9;
    }
    /* paper fibers / specks via inline SVG noise */
    .fibers{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.22;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='420' height='280'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='420' height='280' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
      background-size: 360px 240px;
      mix-blend-mode:multiply;
    }

    /* Slight edge vignette + worn corners */
    .wear{
      position:absolute; inset:-1px;
      pointer-events:none;
      background:
        radial-gradient(180px 140px at 10% 18%, rgba(0,0,0,.08), rgba(0,0,0,0) 70%),
        radial-gradient(190px 150px at 92% 20%, rgba(0,0,0,.06), rgba(0,0,0,0) 70%),
        radial-gradient(200px 160px at 8% 86%, rgba(0,0,0,.07), rgba(0,0,0,0) 70%),
        radial-gradient(200px 160px at 92% 88%, rgba(0,0,0,.06), rgba(0,0,0,0) 70%),
        radial-gradient(1200px 700px at 50% 50%, rgba(0,0,0,.05), rgba(0,0,0,0) 60%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.06));
      opacity:.85;
    }

    /* =========================
       FRONT (Step 0)
       ========================= */
    .frontFace{
      position:absolute; inset:0;
    }

    /* Envelope creases (front) */
    .frontCreases{
      position:absolute; inset:0;
      pointer-events:none;
    }
    .frontCreases:before{
      /* diagonal seams meeting center */
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(135deg, rgba(0,0,0,.00) 47%, rgba(0,0,0,.10) 50%, rgba(0,0,0,.00) 53%),
        linear-gradient(225deg, rgba(0,0,0,.00) 47%, rgba(0,0,0,.10) 50%, rgba(0,0,0,.00) 53%);
      opacity:.30;
      mix-blend-mode:multiply;
    }
    .frontCreases:after{
      /* bottom flap seam */
      content:"";
      position:absolute;
      left:0; right:0;
      bottom:0;
      height:52%;
      background:
        linear-gradient(0deg, rgba(0,0,0,.02), rgba(0,0,0,0)),
        linear-gradient(180deg, rgba(0,0,0,.00) 50%, rgba(0,0,0,.12) 51%, rgba(0,0,0,.00) 53%);
      opacity:.22;
      mix-blend-mode:multiply;
      clip-path: polygon(0% 100%, 100% 100%, 50% 20%);
    }

    .frontText{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      text-align:center;
      padding:24px;
      color: var(--ink);
    }
    .frontText .hand{
      font-family: "Nanum Pen Script", cursive;
      font-size: clamp(36px, 6vw, 58px);
      letter-spacing: .02em;
      line-height:1.05;
      text-shadow: 0 1px 0 rgba(255,255,255,.55);
      transform: translateY(-2px);
    }
    .micro{
      position:absolute;
      left:18px;
      bottom:14px;
      color: rgba(0,0,0,.52);
      font: 12px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      opacity:.75;
      user-select:none;
    }

    /* =========================
       BACK (Step 1)
       ========================= */
    .backFace{
      position:absolute; inset:0;
    }

    /* Back flap (closed) */
    .flap{
      position:absolute;
      left:0; right:0;
      top:0;
      height:62%;
      transform-origin: 50% 0%;
      transform: rotateX(0deg);
      transition: transform 850ms var(--ease);
      will-change: transform;
      pointer-events:none;
      z-index:3;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.08));
    }

    /* When opening (step-2), flap lifts */
    body.step-2 .flap{
      transform: rotateX(-120deg);
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.12));
    }

    .flap::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,.25), rgba(0,0,0,.05)),
        radial-gradient(900px 500px at 50% 20%, rgba(255,255,255,.45), rgba(255,255,255,0) 55%);
      clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
      opacity:.95;
    }
    .flap::after{
      /* flap crease line */
      content:"";
      position:absolute;
      left:0; right:0;
      top:0;
      height:2px;
      background: rgba(0,0,0,.12);
      opacity:.25;
    }

    /* Back creases */
    .backCreases{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.22;
      mix-blend-mode:multiply;
      background:
        linear-gradient(45deg, rgba(0,0,0,0) 49.2%, rgba(0,0,0,.12) 50%, rgba(0,0,0,0) 50.8%),
        linear-gradient(-45deg, rgba(0,0,0,0) 49.2%, rgba(0,0,0,.12) 50%, rgba(0,0,0,0) 50.8%),
        radial-gradient(1200px 700px at 50% 60%, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
    }

    /* Wax seal (irregular, melted, antique ceremonial gold) */
    .sealWrap{
      position:absolute;
      left:50%;
      top:44%;
      transform: translate(-50%,-50%);
      width:96px;
      height:96px;
      z-index:4;
      pointer-events:none;
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.25));
    }

    /* Irregular wax blob via SVG mask-ish clip-path */
    .seal{
      position:absolute;
      inset:0;
      border-radius: 22px;
      /* irregular edges */
      clip-path: polygon(
        10% 18%, 22% 9%, 40% 6%, 60% 10%, 76% 18%,
        90% 34%, 94% 52%, 88% 72%, 74% 86%,
        56% 94%, 36% 92%, 18% 84%, 8% 68%,
        6% 50%, 8% 32%
      );
      background:
        radial-gradient(32px 32px at 28% 26%, rgba(255,255,255,.65), rgba(255,255,255,0) 65%),
        radial-gradient(56px 56px at 62% 60%, rgba(0,0,0,.25), rgba(0,0,0,0) 60%),
        radial-gradient(120px 90px at 45% 35%, var(--gold1), var(--gold2) 45%, var(--gold3) 78%, #5b3c09 100%),
        conic-gradient(from 210deg, rgba(255,255,255,.15), rgba(0,0,0,.18), rgba(255,255,255,.22), rgba(0,0,0,.16), rgba(255,255,255,.12));
      border: 1px solid rgba(70,45,8,.25);
      box-shadow:
        inset 0 2px 3px rgba(255,255,255,.35),
        inset 0 -10px 18px rgba(0,0,0,.22);
      position:relative;
      overflow:hidden;
    }

    /* Wax texture noise */
    .seal::before{
      content:"";
      position:absolute; inset:0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='t'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23t)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.22;
      transform: rotate(8deg) scale(1.15);
    }

    /* Embossed pressed rune */
    .rune{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      transform: translateY(-1px);
    }
    .rune svg{
      width:46px;
      height:46px;
      display:block;
    }
    .rune path{
      fill:none;
      stroke: rgba(25,16,4,.78);
      stroke-width: 3.6;
      stroke-linecap: round;
      stroke-linejoin: round;
      /* deboss effect */
      filter: drop-shadow(0 1px 0 rgba(255,255,255,.30))
              drop-shadow(0 -1px 0 rgba(0,0,0,.35));
      opacity:.95;
    }

    /* Seal cracking/breaking on step-2 */
    body.step-2 .seal{
      animation: sealBreak 680ms var(--ease) 1 forwards;
    }
    @keyframes sealBreak{
      0%{ transform: rotate(0deg) scale(1); }
      35%{ transform: rotate(-2deg) scale(1.02); }
      70%{ transform: rotate(3deg) scale(0.98); }
      100%{ transform: rotate(0deg) scale(0.90); opacity:0; }
    }

    /* A little "split" line appears as it breaks */
    .crack{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:0;
      z-index:5;
    }
    body.step-2 .crack{ opacity:1; transition: opacity 180ms ease; }
    .crack::before{
      content:"";
      position:absolute;
      left:48%;
      top:10%;
      width:2px;
      height:80%;
      background: rgba(55,35,8,.55);
      transform: rotate(16deg);
      box-shadow: 0 0 10px rgba(0,0,0,.15);
      opacity:.55;
    }
    .crack::after{
      content:"";
      position:absolute;
      left:40%;
      top:18%;
      width:2px;
      height:65%;
      background: rgba(255,255,255,.12);
      transform: rotate(16deg);
      opacity:.35;
    }

    /* =========================
       NOTE (Step 2)
       ========================= */
    .note{
      position:absolute;
      left:50%;
      top:55%;
      transform: translate(-50%, -50%);
      width:min(520px, 84vw);
      max-width:520px;
      height:min(270px, 44vw);
      max-height:280px;

      opacity:0;
      pointer-events:none;
      z-index:2;
      transition: opacity 500ms ease, transform 800ms var(--ease);
      transform-origin: 50% 100%;
      transform: translate(-50%, -40%) scale(.98);
    }
    body.step-2 .note{
      opacity:1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events:auto;
    }

    .notePaper{
      position:absolute; inset:0;
      border-radius:14px;
      background: linear-gradient(180deg, #f7f2e8, #efe4d2);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 34px rgba(0,0,0,.22);
      overflow:hidden;
    }
    .notePaper .paperTex,
    .notePaper .fibers,
    .notePaper .wear{ opacity:.35; }

    .noteContent{
      position:absolute;
      inset:18px 18px 16px 18px;
      color: rgba(10,10,10,.92);
      font-family: "Nanum Pen Script", cursive;
      font-size: clamp(20px, 2.6vw, 28px);
      line-height: 1.18;
      letter-spacing: .01em;
      overflow:auto;
      padding-right:10px;
    }
    .noteContent::-webkit-scrollbar{ width:10px; }
    .noteContent::-webkit-scrollbar-thumb{
      background: rgba(0,0,0,.14);
      border-radius: 10px;
    }
    .noteContent .small{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      font-size: 12px;
      letter-spacing:.22em;
      text-transform: uppercase;
      opacity:.55;
      margin-top: 14px;
    }

    /* Back micro hint */
    .microBack{
      position:absolute;
      left:18px;
      bottom:14px;
      color: rgba(0,0,0,.52);
      font: 12px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      opacity:.72;
      user-select:none;
      z-index:1;
    }

    /* =========================
       TUNNEL (Step 3)
       ========================= */
    .tunnel{
      position:fixed;
      inset:0;
      z-index:1;
      opacity:0;
      pointer-events:none;
      transition: opacity 420ms ease;
      background:#000;
    }
    body.step-3 .tunnel{
      opacity:1;
      pointer-events:auto;
    }
    canvas{
      width:100%;
      height:100%;
      display:block;
    }

    /* When tunnel starts, hide envelope quickly so tunnel is clean */
    body.step-3 .stage{
      opacity:0;
      transition: opacity 200ms ease;
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .flip, .flap, .note { transition:none !important; animation:none !important; }
      body.step-3 .stage{ transition:none !important; }
    }
  </style>
</head>

<body class="step-0">
  <!-- Tunnel overlay -->
  <div class="tunnel" aria-hidden="true">
    <canvas id="tunnelCanvas"></canvas>
  </div>

  <div class="stage">
    <div class="card">
      <div class="envelope" id="gate" tabindex="0" role="button" aria-label="Envelope. Click to proceed.">
        <div class="flip">

          <!-- FRONT (Step 0) -->
          <div class="side front">
            <div class="paperTex"></div>
            <div class="fibers"></div>
            <div class="wear"></div>

            <div class="frontFace">
              <div class="frontCreases"></div>
              <div class="frontText">
                <div class="hand">I left this for you</div>
              </div>
              <div class="micro">click</div>
            </div>
          </div>

          <!-- BACK (Step 1+) -->
          <div class="side back">
            <div class="paperTex"></div>
            <div class="fibers"></div>
            <div class="wear"></div>

            <div class="backFace">
              <div class="backCreases"></div>

              <!-- flap (opens on step-2) -->
              <div class="flap"></div>

              <!-- wax seal (breaks on step-2) -->
              <div class="sealWrap" aria-hidden="true">
                <div class="seal">
                  <div class="rune" aria-hidden="true">
                    <!-- Algiz (arms UP) -->
                    <svg viewBox="0 0 64 64" aria-hidden="true">
                      <path d="M32 8 L32 56 M32 22 L18 12 M32 22 L46 12"/>
                    </svg>
                  </div>
                </div>
                <div class="crack"></div>
              </div>

              <div class="microBack">click</div>

              <!-- note appears on step-2 -->
              <div class="note" id="note">
                <div class="notePaper">
                  <div class="paperTex"></div>
                  <div class="fibers"></div>
                  <div class="wear"></div>

                  <div class="noteContent" aria-label="Note">
                    you found it.<br><br>

                    this isn’t a demand. it’s a relic. something i pressed into the dark<br>
                    so it would still be here whenever you finally moved slow enough to notice.<br><br>

                    inside this place, nothing chases you. nothing asks you to perform.<br>
                    nothing tries to rip a confession out of your ribs.<br><br>

                    you can stand at the threshold and breathe. you can leave. you can return.<br><br>

                    but if you enter…<br>
                    enter gently.<br>

                    <div class="small">click once more to enter the tunnel</div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hint">tap / click • four steps • enter gently</div>
  </div>

  <script>
    // ===== State machine =====
    // step-0: front envelope, handwriting centered
    // step-1: flip to back, flap up + wax seal present
    // step-2: seal breaks + flap opens + long note appears + paper rustle
    // step-3: tunnel (visible) then redirect to /vault/
    (function(){
      const body = document.body;
      const gate = document.getElementById('gate');

      let step = 0;
      let audioUnlocked = false;

      // --- WebAudio tiny foley (no external files) ---
      let ctx;

      function ensureAudio(){
        if(audioUnlocked) return;
        try{
          ctx = new (window.AudioContext || window.webkitAudioContext)();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.connect(g); g.connect(ctx.destination);
          g.gain.value = 0.0001;
          o.start();
          o.stop(ctx.currentTime + 0.01);
          audioUnlocked = true;
        }catch(e){}
      }

      function noiseBurst(duration=0.12, gain=0.05, tone=1200){
        if(!ctx) return;
        const sr = ctx.sampleRate;
        const len = Math.floor(sr * duration);
        const buf = ctx.createBuffer(1, len, sr);
        const data = buf.getChannelData(0);

        // "paper-ish" noise shaped
        for(let i=0;i<len;i++){
          const t = i/len;
          const env = Math.pow(1 - t, 2.6);
          data[i] = (Math.random()*2 - 1) * env;
        }

        const src = ctx.createBufferSource();
        src.buffer = buf;

        // filter
        const bp = ctx.createBiquadFilter();
        bp.type = "bandpass";
        bp.frequency.value = tone;
        bp.Q.value = 0.9;

        const hp = ctx.createBiquadFilter();
        hp.type = "highpass";
        hp.frequency.value = 500;

        const g = ctx.createGain();
        g.gain.value = gain;

        src.connect(bp); bp.connect(hp); hp.connect(g); g.connect(ctx.destination);
        src.start();
      }

      function clickTick(){
        if(!ctx) return;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "triangle";
        o.frequency.setValueAtTime(900, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(220, ctx.currentTime + 0.04);
        g.gain.setValueAtTime(0.06, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.06);
        o.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + 0.07);
      }

      function waxCrack(){
        // sharper crack + small low thump
        noiseBurst(0.08, 0.07, 2400);
        if(!ctx) return;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.setValueAtTime(140, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(70, ctx.currentTime + 0.10);
        g.gain.setValueAtTime(0.08, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.14);
        o.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + 0.16);
      }

      function paperRustle(){
        noiseBurst(0.18, 0.05, 1400);
        noiseBurst(0.12, 0.03, 900);
      }

      function whoosh(){
        if(!ctx) return;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        const lp = ctx.createBiquadFilter();
        lp.type = "lowpass";
        lp.frequency.setValueAtTime(1200, ctx.currentTime);
        lp.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + 0.8);

        o.type = "sawtooth";
        o.frequency.setValueAtTime(140, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(60, ctx.currentTime + 0.8);

        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.08);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.9);

        o.connect(lp); lp.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + 0.95);

        // extra air noise
        noiseBurst(0.28, 0.025, 700);
      }

      function setState(n){
        body.classList.remove('step-0','step-1','step-2','step-3');
        body.classList.add(`step-${n}`);
      }

      function next(){
        step = Math.min(step + 1, 3);
        setState(step);

        if(step === 1){
          clickTick();
        }

        if(step === 2){
          // seal break + flap open + note
          waxCrack();
          setTimeout(paperRustle, 140);
        }

        if(step === 3){
          whoosh();
          startTunnel();

          // Keep tunnel visible before redirect
          setTimeout(() => {
            window.location.href = "/vault/";
          }, 1600);
        }
      }

      gate.addEventListener('click', (e) => {
        e.preventDefault();
        ensureAudio();
        next();
      });

      gate.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          ensureAudio();
          next();
        }
      });

      // ===== Tunnel animation =====
      const canvas = document.getElementById('tunnelCanvas');
      const ctx2 = canvas.getContext('2d');

      let w, h, dpr, rafId, t = 0;
      function resize(){
        dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        w = canvas.clientWidth;
        h = canvas.clientHeight;
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx2.setTransform(dpr,0,0,dpr,0,0);
      }
      window.addEventListener('resize', resize);

      function draw(){
        t += 0.016;
        ctx2.clearRect(0,0,w,h);

        const cx = w/2, cy = h/2;
        const maxR = Math.hypot(w,h) * 0.72;

        // vignette
        const vg = ctx2.createRadialGradient(cx, cy, 0, cx, cy, Math.max(w,h)/1.08);
        vg.addColorStop(0, 'rgba(18,18,28,0.12)');
        vg.addColorStop(0.55, 'rgba(0,0,0,0.78)');
        vg.addColorStop(1, 'rgba(0,0,0,1)');
        ctx2.fillStyle = vg;
        ctx2.fillRect(0,0,w,h);

        // rings
        const depth = 52;
        const speed = 260;
        const base = (t * speed) % 90;

        for(let i=0;i<depth;i++){
          const z = (i * 90 + base);
          const p = (z % (depth*90)) / (depth*90);
          const ease = Math.pow(1 - p, 2.25);

          const r = 36 + ease * maxR;
          const alpha = 0.012 + ease * 0.13;

          const wobX = Math.sin(t*1.4 + i*0.48) * (8 + 14*ease);
          const wobY = Math.cos(t*1.1 + i*0.51) * (8 + 14*ease);

          ctx2.beginPath();
          ctx2.arc(cx + wobX, cy + wobY, r, 0, Math.PI*2);
          ctx2.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx2.lineWidth = 0.8 + 3.6*ease;
          ctx2.stroke();
        }

        // faint grain
        ctx2.fillStyle = 'rgba(255,255,255,0.03)';
        for(let i=0;i<140;i++){
          ctx2.fillRect(Math.random()*w, Math.random()*h, 1, 1);
        }

        rafId = requestAnimationFrame(draw);
      }

      let tunnelRunning = false;
      function startTunnel(){
        if(tunnelRunning) return;
        tunnelRunning = true;
        resize();
        draw();
      }
    })();
  </script>
</body>
</html>
