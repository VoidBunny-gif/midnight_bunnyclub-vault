<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Babe</title>

  <style>
    :root{
      --bg:#07070a;

      /* Paper */
      --paper:#f6f1e7;
      --paper2:#efe6d7;
      --paperEdge:#e7dccb;
      --paperInk:#161616;

      /* Stage */
      --shadow: 0 22px 70px rgba(0,0,0,.62);
      --radius: 18px;

      /* Antique ceremonial gold (wax-ish) */
      --gold1:#5f4411;
      --gold2:#94681f;
      --gold3:#caa24a;
      --gold4:#f1dd9b;
      --gold5:#7c5618;

      /* Handwriting stack (no external font fetch) */
      --hand: "Bradley Hand", "Segoe Script", "Snell Roundhand", "Apple Chancery", "Comic Sans MS", cursive;
      --serif: ui-serif, Georgia, "Times New Roman", Times, serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      overflow:hidden;
      color:#fff;
      background:
        radial-gradient(1100px 760px at 50% 38%, #141420 0%, var(--bg) 58%, #040406 100%);
      font-family: var(--serif);
    }

    .stage{
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
      position:relative;
      z-index:2;
    }

    .hint{
      position:absolute;
      bottom:28px;
      left:0; right:0;
      text-align:center;
      letter-spacing:.22em;
      text-transform:uppercase;
      font: 12px/1.2 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      opacity:.75;
      user-select:none;
      pointer-events:none;
    }

    .card{
      width:min(620px, 94vw);
      aspect-ratio: 16 / 9;
      border-radius: var(--radius);
      background: rgba(255,255,255,.04);
      box-shadow: var(--shadow);
      position:relative;
      display:grid;
      place-items:center;
      perspective: 1300px;
    }

    /* Envelope wrapper */
    .envelope{
      width:min(560px, 88vw);
      height:min(330px, 54vw);
      max-height:340px;
      position:relative;
      transform-style:preserve-3d;
      cursor:pointer;
      user-select:none;
      border-radius: 14px;
      outline:none;
    }

    .flip{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition: transform 900ms cubic-bezier(.18,.9,.12,1);
      border-radius:14px;
    }

    /* Step mapping
       state-0: front
       state-1: back
       state-2: back open + note
       state-3: tunnel
    */
    body.state-1 .flip,
    body.state-2 .flip{
      transform: rotateY(180deg);
    }

    .side{
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius:14px;
      overflow:hidden;
    }
    .side.back{ transform: rotateY(180deg); }

    /* Paper surface (realistic-ish) */
    .paperSurface{
      position:absolute; inset:0;
      border-radius:14px;
      background:
        /* subtle top light */
        radial-gradient(900px 380px at 50% 0%, rgba(255,255,255,.65) 0%, rgba(255,255,255,0) 55%),
        /* fiber-ish */
        linear-gradient(180deg, var(--paper) 0%, var(--paper2) 100%);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow:
        0 18px 45px rgba(0,0,0,.22),
        inset 0 0 0 1px rgba(255,255,255,.22);
    }

    /* Paper grain overlay */
    .paperSurface::after{
      content:"";
      position:absolute; inset:-10%;
      background:
        /* tiny specks */
        radial-gradient(circle at 12% 18%, rgba(0,0,0,.07) 0 1px, transparent 2px),
        radial-gradient(circle at 36% 62%, rgba(0,0,0,.06) 0 1px, transparent 2px),
        radial-gradient(circle at 78% 28%, rgba(0,0,0,.05) 0 1px, transparent 2px),
        radial-gradient(circle at 86% 72%, rgba(0,0,0,.06) 0 1px, transparent 2px),
        /* fibers */
        repeating-linear-gradient(25deg, rgba(0,0,0,.022) 0 1px, transparent 1px 9px),
        repeating-linear-gradient(-18deg, rgba(0,0,0,.018) 0 1px, transparent 1px 11px);
      mix-blend-mode:multiply;
      opacity:.55;
      transform: rotate(-2deg);
      pointer-events:none;
    }

    /* Slight edge wear vignette */
    .edgeWear{
      position:absolute; inset:0;
      border-radius:14px;
      pointer-events:none;
      background:
        radial-gradient(closest-side at 0% 0%, rgba(0,0,0,.10), transparent 55%),
        radial-gradient(closest-side at 100% 0%, rgba(0,0,0,.08), transparent 55%),
        radial-gradient(closest-side at 0% 100%, rgba(0,0,0,.09), transparent 55%),
        radial-gradient(closest-side at 100% 100%, rgba(0,0,0,.10), transparent 55%);
      opacity:.65;
    }

    /* ----- FRONT (Step 0) ----- */
    .frontText{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      text-align:center;
      padding:22px;
      color:rgba(0,0,0,.78);
    }
    .frontText .line{
      font-family: var(--hand);
      font-size: clamp(28px, 4.4vw, 46px);
      letter-spacing:.01em;
      transform: rotate(-0.6deg);
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }

    .micro{
      position:absolute;
      left:18px;
      bottom:16px;
      color: rgba(0,0,0,.42);
      font: 12px/1 var(--mono);
      opacity:.85;
    }

    /* ----- BACK (Step 1 + Step 2) ----- */
    .backLayout{
      position:absolute; inset:0;
    }

    /* Flap (closed) - flap side UP */
    .flap{
      position:absolute;
      left:0; right:0;
      top:0;
      height:56%;
      transform-origin: 50% 0%;
      transform: rotateX(0deg);
      transition: transform 850ms cubic-bezier(.18,.9,.12,1);
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.12));
    }

    /* When opening (state-2), flap lifts */
    body.state-2 .flap{
      transform: rotateX(-155deg) translateY(-2px);
      filter: drop-shadow(0 24px 24px rgba(0,0,0,.16));
    }

    /* Flap shape */
    .flap::before{
      content:"";
      position:absolute;
      left:50%;
      top:-2px;
      width:0; height:0;
      transform: translateX(-50%);
      border-left: 280px solid transparent;
      border-right:280px solid transparent;
      border-bottom: 190px solid rgba(0,0,0,.075);
      opacity:.9;
    }

    /* Back creases (subtle envelope geometry) */
    .backCreases{
      position:absolute; inset:0;
      pointer-events:none;
      background:
        linear-gradient(135deg, transparent 46%, rgba(0,0,0,.055) 50%, transparent 54%),
        linear-gradient(-135deg, transparent 46%, rgba(0,0,0,.055) 50%, transparent 54%),
        linear-gradient(0deg, transparent 62%, rgba(0,0,0,.035) 70%, transparent 78%);
      opacity:.55;
    }

    /* Wax seal */
    .seal{
      position:absolute;
      left:50%;
      top:46%;
      transform: translate(-50%, -50%);
      width:92px;
      height:92px;
      border-radius: 999px;
      pointer-events:none;
      opacity:1;
      transition: transform 500ms ease, opacity 450ms ease;
      filter:
        drop-shadow(0 10px 12px rgba(0,0,0,.22))
        drop-shadow(0 2px 0 rgba(255,255,255,.22));
    }

    /* When opening, seal "breaks" and drops */
    body.state-2 .seal{
      opacity:0;
      transform: translate(-50%, -35%) rotate(-8deg) scale(.92);
    }

    /* Irregular wax edge using pseudo + blur */
    .seal::before{
      content:"";
      position:absolute; inset:-6px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.32), transparent 42%),
        radial-gradient(circle at 70% 78%, rgba(0,0,0,.25), transparent 44%),
        conic-gradient(from 210deg,
          rgba(0,0,0,.12),
          rgba(255,255,255,.10),
          rgba(0,0,0,.10),
          rgba(255,255,255,.08),
          rgba(0,0,0,.12)
        );
      filter: blur(1.4px);
      opacity:.55;
      transform: rotate(6deg);
    }

    /* Wax body: antique ceremonial gold with micro-texture */
    .seal .wax{
      position:absolute; inset:0;
      border-radius:999px;
      background:
        /* metallic highlight sweep */
        radial-gradient(circle at 30% 28%, var(--gold4) 0%, rgba(255,255,255,0) 42%),
        radial-gradient(circle at 72% 78%, rgba(0,0,0,.35) 0%, rgba(0,0,0,0) 46%),
        linear-gradient(145deg, var(--gold2) 0%, var(--gold3) 38%, var(--gold5) 72%, var(--gold1) 100%);
      box-shadow:
        inset 0 2px 4px rgba(255,255,255,.22),
        inset 0 -10px 18px rgba(0,0,0,.26),
        0 0 0 1px rgba(0,0,0,.10);
      overflow:hidden;
    }

    /* Wax texture speckle */
    .seal .wax::after{
      content:"";
      position:absolute; inset:-20%;
      background:
        repeating-radial-gradient(circle at 40% 40%,
          rgba(0,0,0,.08) 0 1px,
          transparent 1px 7px
        ),
        repeating-linear-gradient(22deg, rgba(255,255,255,.06) 0 1px, transparent 1px 9px);
      opacity:.25;
      transform: rotate(-8deg);
      mix-blend-mode: overlay;
    }

    /* Pressed Algiz (upright) */
    .seal svg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      transform: rotate(0deg);
    }
    .seal .engrave{
      fill:none;
      stroke: rgba(30,18,5,.62);
      stroke-width: 3.2;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 1px 0 rgba(255,255,255,.22));
      opacity:.88;
    }
    .seal .highlight{
      fill:none;
      stroke: rgba(255,255,255,.22);
      stroke-width: 2.2;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity:.55;
      transform: translateY(-1px);
    }

    /* NOTE reveal (Step 2) */
    .note{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      opacity:0;
      transform: translateY(14px);
      transition: opacity 520ms ease, transform 520ms ease;
      pointer-events:none;
    }
    body.state-2 .note{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    .note .paper{
      width:min(440px, 76vw);
      padding:18px 18px;
      border-radius:12px;
      color:#111;
      background:
        radial-gradient(300px 160px at 50% 0%, rgba(255,255,255,.75), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.88));
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 34px rgba(0,0,0,.28);
      position:relative;
      overflow:hidden;
    }
    .note .paper::after{
      content:"";
      position:absolute; inset:-20%;
      background:
        repeating-linear-gradient(18deg, rgba(0,0,0,.025) 0 1px, transparent 1px 12px),
        repeating-linear-gradient(-12deg, rgba(0,0,0,.018) 0 1px, transparent 1px 14px);
      opacity:.35;
      mix-blend-mode:multiply;
      transform: rotate(3deg);
    }

    .note .msg{
      position:relative;
      font-family: var(--hand);
      font-size: clamp(22px, 3.8vw, 34px);
      color: rgba(0,0,0,.78);
      line-height: 1.2;
      letter-spacing:.01em;
      text-align:left;
      padding-right:6px;
    }
    .note .sub{
      position:relative;
      margin-top:8px;
      font: 12px/1.2 var(--mono);
      letter-spacing:.14em;
      text-transform:uppercase;
      opacity:.55;
    }

    /* Tunnel overlay */
    .tunnel{
      position:fixed;
      inset:0;
      z-index:1;
      opacity:0;
      pointer-events:none;
      transition: opacity 520ms ease;
      background:#000;
    }
    body.state-3 .tunnel{
      opacity:1;
      pointer-events:auto;
    }
    canvas{ width:100%; height:100%; display:block; }

    @media (prefers-reduced-motion: reduce){
      .flip, .flap, .note, .tunnel{ transition:none !important; }
    }
  </style>
</head>

<body class="state-0">
  <!-- Tunnel (appears on state-3) -->
  <div class="tunnel" aria-hidden="true">
    <canvas id="tunnelCanvas"></canvas>
  </div>

  <div class="stage">
    <div class="card">
      <div class="envelope" id="gate" tabindex="0" role="button" aria-label="Envelope gate. Click to proceed.">
        <div class="flip">

          <!-- FRONT (Step 0): message centered -->
          <div class="side front">
            <div class="paperSurface"></div>
            <div class="edgeWear"></div>

            <div class="frontText" aria-hidden="true">
              <div class="line">I left this for you</div>
            </div>

            <div class="micro">click</div>
          </div>

          <!-- BACK (Step 1 + Step 2): flap up + wax seal -->
          <div class="side back">
            <div class="paperSurface"></div>
            <div class="edgeWear"></div>

            <div class="backLayout" aria-hidden="true">
              <div class="backCreases"></div>

              <div class="flap" aria-hidden="true"></div>

              <div class="seal" aria-hidden="true">
                <div class="wax"></div>
                <!-- Algiz pressed (upright) -->
                <svg viewBox="0 0 100 100" aria-hidden="true">
                  <!-- main carve -->
                  <path class="engrave" d="M50 22 L50 70 M50 30 L34 44 M50 30 L66 44" />
                  <!-- subtle highlight edge -->
                  <path class="highlight" d="M50 22 L50 70 M50 30 L34 44 M50 30 L66 44" />
                </svg>
              </div>

              <div class="micro">click</div>
            </div>
          </div>
        </div>

        <!-- NOTE (revealed on Step 2) -->
        <div class="note" aria-hidden="true">
          <div class="paper">
            <div class="msg">
              i left this here for you.<br/>
              enter gently.
            </div>
            <div class="sub">click to enter</div>
          </div>
        </div>
      </div>
    </div>

    <div class="hint">tap / click • four steps • enter gently</div>
  </div>

  <script>
    /**
     * STATES
     * 0: Front message
     * 1: Back flap up + sealed
     * 2: Seal breaks + flap opens + note
     * 3: Tunnel -> /vault/
     */

    (function(){
      const body = document.body;
      const gate = document.getElementById('gate');

      let step = 0;

      function setState(n){
        body.classList.remove('state-0','state-1','state-2','state-3');
        body.classList.add(`state-${n}`);
      }

      // --------- AUDIO (generated) ----------
      let audioOn = false;
      let ac, master;

      function ensureAudio(){
        if(audioOn) return;
        audioOn = true;
        ac = new (window.AudioContext || window.webkitAudioContext)();
        master = ac.createGain();
        master.gain.value = 0.55;
        master.connect(ac.destination);
      }

      function noiseBuffer(duration=0.25){
        const sr = ac.sampleRate;
        const len = Math.floor(sr * duration);
        const buf = ac.createBuffer(1, len, sr);
        const data = buf.getChannelData(0);
        for(let i=0;i<len;i++){
          // slightly pink-ish noise (simple)
          const white = (Math.random()*2-1);
          data[i] = white * (1 - i/len) * 0.55;
        }
        return buf;
      }

      function playRustle(){
        ensureAudio();
        const src = ac.createBufferSource();
        src.buffer = noiseBuffer(0.22);

        const hp = ac.createBiquadFilter();
        hp.type = "highpass";
        hp.frequency.value = 650;

        const bp = ac.createBiquadFilter();
        bp.type = "bandpass";
        bp.frequency.value = 1800;
        bp.Q.value = 0.8;

        const g = ac.createGain();
        g.gain.setValueAtTime(0.0001, ac.currentTime);
        g.gain.exponentialRampToValueAtTime(0.16, ac.currentTime + 0.03);
        g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime + 0.22);

        src.connect(hp);
        hp.connect(bp);
        bp.connect(g);
        g.connect(master);

        src.start();
      }

      function playSealCrack(){
        ensureAudio();
        // quick "snap" + low thump
        const now = ac.currentTime;

        // snap (short noise burst)
        const n = ac.createBufferSource();
        n.buffer = noiseBuffer(0.08);
        const bp = ac.createBiquadFilter();
        bp.type = "bandpass";
        bp.frequency.value = 2400;
        bp.Q.value = 2.2;

        const ng = ac.createGain();
        ng.gain.setValueAtTime(0.0001, now);
        ng.gain.exponentialRampToValueAtTime(0.22, now + 0.01);
        ng.gain.exponentialRampToValueAtTime(0.0001, now + 0.07);

        n.connect(bp); bp.connect(ng); ng.connect(master);
        n.start(now);

        // thump (sine)
        const osc = ac.createOscillator();
        osc.type = "sine";
        osc.frequency.setValueAtTime(130, now);

        const og = ac.createGain();
        og.gain.setValueAtTime(0.0001, now);
        og.gain.exponentialRampToValueAtTime(0.12, now + 0.01);
        og.gain.exponentialRampToValueAtTime(0.0001, now + 0.14);

        osc.connect(og); og.connect(master);
        osc.start(now);
        osc.stop(now + 0.16);
      }

      function playChime(){
        ensureAudio();
        const now = ac.currentTime;
        const o = ac.createOscillator();
        o.type = "sine";
        o.frequency.setValueAtTime(740, now);

        const g = ac.createGain();
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.08, now + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now + 0.35);

        o.connect(g); g.connect(master);
        o.start(now);
        o.stop(now + 0.38);
      }

      // --------- CLICK FLOW ----------
      function next(){
        const prev = step;
        step = Math.min(step + 1, 3);
        setState(step);

        // Sound cues matched to ritual
        if(step === 0) return;

        if(step === 1){
          // flip to back (soft paper)
          playRustle();
        } else if(step === 2){
          // seal breaks + flap opens
          playSealCrack();
          setTimeout(playRustle, 80);
          setTimeout(playChime, 140);
        } else if(step === 3){
          startTunnel();
          setTimeout(() => {
            window.location.href = "/vault/";
          }, 1250);
        }
      }

      function onActivate(e){
        e.preventDefault();
        next();
      }

      gate.addEventListener('click', onActivate);
      gate.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          next();
        }
      });

      // --------- TUNNEL (depth rings, alive motion) ----------
      const canvas = document.getElementById('tunnelCanvas');
      const ctx = canvas.getContext('2d');

      let w, h, dpr, rafId;
      let t = 0;
      let tunnelRunning = false;

      function resize(){
        dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        w = canvas.clientWidth;
        h = canvas.clientHeight;
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      window.addEventListener('resize', resize);

      function draw(){
        t += 0.016;
        ctx.clearRect(0,0,w,h);

        const cx = w/2, cy = h/2;
        const maxR = Math.hypot(w,h) * 0.72;

        // Vignette
        const vg = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(w,h)/1.12);
        vg.addColorStop(0, 'rgba(10,10,14,0.08)');
        vg.addColorStop(0.55, 'rgba(0,0,0,0.76)');
        vg.addColorStop(1, 'rgba(0,0,0,1)');
        ctx.fillStyle = vg;
        ctx.fillRect(0,0,w,h);

        // Slight swirl in center so it feels like "pull"
        const swirl = Math.sin(t*0.8) * 0.35;

        const speed = 240;
        const depth = 54;
        const base = (t * speed) % 90;

        for(let i=0;i<depth;i++){
          const z = (i * 90 + base);
          const p = (z % (depth*90)) / (depth*90); // 0..1
          const ease = Math.pow(1 - p, 2.25);

          const r = 26 + ease * maxR;

          const wobX = Math.sin(t*1.55 + i*0.47) * (5 + 11*ease);
          const wobY = Math.cos(t*1.28 + i*0.52) * (5 + 11*ease);

          const alpha = 0.02 + ease * 0.12;
          const thick = 0.9 + 3.4*ease;

          // slight angular drift
          const ang = (i*0.12 + t*0.55 + swirl);
          const driftX = Math.cos(ang) * (2 + 9*ease);
          const driftY = Math.sin(ang) * (2 + 9*ease);

          ctx.beginPath();
          ctx.arc(cx + wobX + driftX, cy + wobY + driftY, r, 0, Math.PI*2);
          ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx.lineWidth = thick;
          ctx.stroke();
        }

        // Faint grain
        ctx.fillStyle = 'rgba(255,255,255,0.03)';
        for(let i=0;i<110;i++){
          const x = Math.random()*w;
          const y = Math.random()*h;
          ctx.fillRect(x,y,1,1);
        }

        rafId = requestAnimationFrame(draw);
      }

      function startTunnel(){
        if(tunnelRunning) return;
        tunnelRunning = true;
        resize();
        draw();
      }
    })();
  </script>
</body>
</html>


